# wop_organizations_map

Interactive map site for:

- Asian American organizations
- Latino organizations

Full title used on the site:
**Asian American and Latino Advocacy, Community Service, and Hybrid Organizations**

Developer attribution on site:
[Jae Yeon Kim](https://jaeyk.github.io/)

## Repository Structure

- `raw_data/`: source CSV files
  - `asian_org.csv`
  - `latino_org.csv`
- `processed_data/`: geocoded outputs generated by script
- `scripts/geocode_organizations.py`: geocoding pipeline
- `index.html`, `styles.css`, `app.js`: static web app
- `misc/`: documentation sources (data collection and codebook)
- `.github/workflows/pages.yml`: GitHub Pages build/deploy workflow

## Data Schema

Raw CSV fields:

- `Name`
- `F.year`
- `Address`
- `States`
- `City`
- `County`
- `Type` (`CSO`, `Advocacy`, `Hybrid`)

Geocoded fields added by pipeline:

- `latitude`
- `longitude`
- `geocode_source`
- `geocode_input`
- `matched_address`
- `match_type`

## Type Labeling Rules in UI

Internally, CSV uses `CSO`.
In the site UI, `CSO` is displayed as:

- `Community Service Organization`

This applies to filter labels, popups, table display, and notes.

## Geocoding Pipeline

Script:

```bash
python3 scripts/geocode_organizations.py
```

Default provider:

- `geocodio`

Supported providers:

- `geocodio`
- `census`
- `auto`

Provider selection examples:

```bash
python3 scripts/geocode_organizations.py --provider geocodio
python3 scripts/geocode_organizations.py --provider census
python3 scripts/geocode_organizations.py --provider auto
```

Output files:

- `processed_data/asian_org_geocoded.csv`
- `processed_data/latino_org_geocoded.csv`
- `processed_data/geocode_cache.json`

### API Key Handling (Geocodio)

Key lookup order in script:

1. `--geocodio-key`
2. `GEOCODIO_API_KEY` environment variable
3. `.env.local` in project root

Local secret file format:

```bash
GEOCODIO_API_KEY=your_key_here
```

Security notes:

- `.env.local` is git-ignored.
- Do not commit API keys.

## Local Run

1. Generate geocoded data:

```bash
python3 scripts/geocode_organizations.py
```

2. Start static server:

```bash
python3 -m http.server 8000
```

3. Open:

- `http://localhost:8000`

### If port is already in use

Use a random free port:

```bash
python3 -m http.server 0
```

Then open the printed localhost URL.

If needed, try IPv4 explicitly:

- `http://127.0.0.1:<port>`

### If the page still shows old text/styles

Browser cache issue. Hard refresh:

- macOS: `Cmd + Shift + R`

## Map Behavior

- Map layout is top-down (stacked), not side-by-side.
- App loads geocoded CSV first; if missing, falls back to raw CSV.
- Point markers show geocoded organizations.
- Gray fallback markers summarize unmatched rows by state.
- Clicking markers filters the records table.

## GitHub Actions + GitHub Pages Deployment

Workflow:

- `.github/workflows/pages.yml`

Trigger:

- push to `main`
- manual dispatch

CI steps:

1. Checkout repository
2. Setup Python
3. Run geocoding (`--provider auto`)
4. Assemble `_site/` deploy artifact
5. Deploy to GitHub Pages

### Required repository settings

1. Set Pages source to **GitHub Actions**.
2. Add repository secret:
   - Name: `GEOCODIO_API_KEY`
   - Path: `Settings > Secrets and variables > Actions`

## Quick Commands

Geocode + serve:

```bash
python3 scripts/geocode_organizations.py && python3 -m http.server 8000
```

Serve on random free port:

```bash
python3 -m http.server 0
```
